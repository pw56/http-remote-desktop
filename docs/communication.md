# 通信内容

## 概要
リモートで接続するデバイスとブラウザが通信する内容と、その際に使用されるプロトコル。

## 内容

### リクエスト
- ブラウザからデバイスへの接続
> ブラウザで入力したパスワードをYAML形式でデバイスに送信する
>
> 例:
>
> ブラウザでパスワードを「abc123」と入力したとき
> ```yaml
> password: "abc123"
> ```
>
> ブラウザでパスワードを「null」と入力したとき
> ```yaml
> password: "null"
> ```

- デバイスの出力先を設定
> デバイスの仮想出力先を設定
>
> 例:
>
> デバイスの仮想ディスプレイを設定
> ```yaml
> display:
>   name: "browser_user_agent"
>   size:
>     x: 2000
>     y: 1500
>   hz: 60
> ```
>
> デバイスの仮想オーディオを設定
> ```yaml
> audio:
>   name: "browser_user_agent"
> ```

- ブラウザからデバイスへの接続を確認・停止
> リモートデスクトップの接続を確認する信号をYAML形式でデバイスに送信する
>
> 例:
>
> リモートデスクトップの接続維持信号を1分ごとに送信
> ```yaml
> connection: keep
> ```
>
> リモートデスクトップを終了する信号
> ```yaml
> connection: exit
> ```

- デバイスからブラウザへの、機器への接続を要求
> デバイスからブラウザへ、機器への接続をYAML形式で要求する
>
> 例:
>
> デバイスからブラウザのマイクへ接続を要求
> ```yaml
> connect:
>  - microphone
> ```
>
> デバイスからブラウザのカメラへ接続を要求
> ```yaml
> connect:
>  - camera
> ```
>
> デバイスからブラウザのカメラとマイクへ接続を要求
> ```yaml
> connect:
>  - camera
>  - microphone
> ```

- デバイスからブラウザへの、機器への接続解除を要求
> デバイスからブラウザへ、機器への接続解除をYAML形式で要求する
>
> 例:
>
> デバイスからブラウザのマイクへ接続解除を要求
> ```yaml
> disconnect:
>  - microphone
> ```
>
> デバイスからブラウザのカメラへ接続解除を要求
> ```yaml
> disconnect:
>  - camera
> ```

### メディア
- 画面
> デバイスの画面のスクリーンショットを1秒間に仮想ディスプレイのリフレッシュレート(Hz)の回数分、ハードウェアエンコードを利用し、HEVC形式にエンコードして、UDPでリアルタイムで送信

- 音声
> デバイスの音声信号を1秒間に30000回、ブラウザにUDPでリアルタイムで送信
>
> 例:
> 
> デバイスのシステム全体で音が最大出力の25%で出力されているとき
> ```
> 0.25
> ```
>
> デバイスのシステム全体で音が出力されていないときは何も送信しない

### 入力
- キーボード
> ブラウザのキーボード入力の変化を十進数キーコードでYAML形式でリアルタイムでデバイスに送信
>
> 例:
>
> 入力がないとき
> ```yaml
> keys:
>  - false
> ```
>
> 'A'キーが押されたとき
> ```yaml
> keys:
>  - 65
> ```
>
> Shiftキーと'2'キーが押されたとき
> ```yaml
> keys:
>  - 16
>  - 56
> ```
>
> Shiftキーと'2'キーが押された状態から、Shiftキーのみが離されたとき
> ```yaml
> keys:
>  - 56
> ```

- マウス
> ブラウザのマウスのディスプレイ上の絶対座標をYAML形式でデバイスにリアルタイムで送信
>
> 例:
>
> ボタンが押されていないとき
> ```yaml
> mouse:
>  - false
> ```
>
> 左のボタンが押されたとき
> ```yaml
> mouse:
>  - button_left
> ```
>
> 中央(ホイール)のボタンが押されたとき
> ```yaml
> mouse:
>  - button_middle
> ```
>
> 左のボタンと右のボタンが押された状態から、左のボタンのみが離されたとき
> ```yaml
> mouse:
>  - button_right
> ```
>
> マウスが左上に動かされ、座標が(X: -50, Y: 50)になったとき
> ```yaml
> mouse:
>  - displacement:
>     x: -50
>     y: 50
> ```
>
> マウスのホイールが下にスクロールされたとき
> ```yaml
> mouse:
>  - wheel: -20
> ```

- マイク
> デバイス側のリクエストに応じて、ブラウザのマイク入力をYAML形式でリアルタイムでデバイスに送信
>
> 例:
> 
> ブラウザでマイクに589Hzの音が最大出力の38%で入力されているとき
> ```yaml
> audio:
>  - hz: 589
>  - power: 0.38
> ```
>
> ブラウザでマイクに100Hzの音が最大出力の100%で入力されているとき
> ```yaml
> audio:
>  - hz: 100
>  - power: 100
> ```
>
> ブラウザでマイクがミュートまたは、マイクにアクセスできないとき
> ```yaml
> audio:
>  - hz: null
>  - power: null
> ```

- カメラ
> デバイス側のリクエストに応じて、ブラウザのカメラ映像をハードウェアエンコードを利用し、HEVC形式にエンコードして、UDPでリアルタイムでデバイスに送信

### ポート
- USB
> デバイスとブラウザのUSBデバイスの信号をYAML形式でリアルタイムで双方向通信
>
> 例:
> 
> ブラウザ側の複数のUSBデバイスに入力があったとき
> ```yaml
> usb_in:
>  - device1: binary_data_hex
>  - device3: binary_data_hex
> ```
>
> デバイス側から複数のUSBデバイスに出力したとき
> ```yaml
> usb_out:
>  - device1: binary_data_hex
>  - device2: binary_data_hex
> ```

- Bluetooth
> デバイスとブラウザのBluetoothデバイスの信号をYAML形式でリアルタイムで双方向通信
>
> 例:
> 
> ブラウザ側の複数のBluetoothデバイスに入力があったとき
> ```yaml
> bluetooth_receive:
>  - device1: binary_data_hex
>  - device3: binary_data_hex
> ```
>
> デバイス側から複数のBluetoothデバイスに出力したとき
> ```yaml
> bluetooth_send:
>  - device1: binary_data_hex
>  - device2: binary_data_hex
> ```