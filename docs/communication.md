# 通信内容

## 概要
リモートで接続するデバイスとブラウザが通信する内容と、その際に使用されるプロトコル。

## 内容

### リクエスト
- ブラウザからデバイスへの接続
> ブラウザで入力したパスワードをYAML形式でデバイスに送信する
>
> 例:
>
> ブラウザでパスワードを「abc123」と入力したとき
> ```yaml
> password: "abc123"
> ```
>
> ブラウザでパスワードを「null」と入力したとき
> ```yaml
> password: "null"
> ```

- ブラウザからデバイスへの接続を停止
> リモートデスクトップを停止する信号をYAML形式でデバイスに送信する
>
> 例:
>
> リモートデスクトップを終了する信号
> ```yaml
> connection: exit
> ```
>
> リモートデスクトップを一時停止する信号
> ```yaml
> connection: pause
> ```

- デバイスからブラウザへの、機器への接続を要求
> デバイスからブラウザへ、機器への接続をYAML形式で要求する
>
> 例:
>
> デバイスからブラウザのマイクへ接続を要求
> ```yaml
> connect:
>  - microphone
> ```
>
> デバイスからブラウザのカメラへ接続を要求
> ```yaml
> connect:
>  - camera
> ```
>
> デバイスからブラウザのカメラとマイクへ接続を要求
> ```yaml
> connect:
>  - camera
>  - microphone
> ```

- デバイスからブラウザへの、機器への接続解除を要求
> デバイスからブラウザへ、機器への接続解除をYAML形式で要求する
>
> 例:
>
> デバイスからブラウザのマイクへ接続解除を要求
> ```yaml
> disconnect:
>  - microphone
> ```
>
> デバイスからブラウザのカメラへ接続解除を要求
> ```yaml
> disconnect:
>  - camera
> ```

### メディア
- 画面
> デバイスの画面のスクリーンショットを1秒間に60回、ハードウェアエンコードを利用し、HEVC形式にエンコードして、UDPでリアルタイムで送信

- 音声
> デバイスの音声の情報をYAML形式で1秒間に30000回、ブラウザにUDPでリアルタイムで送信
>
> 例:
> 
> デバイスのシステム全体で300Hzの音が最大出力の25%で出力されているとき
> ```yaml
> audio:
>  - hz: 300
>  - power: 0.25
> ```
>
> デバイスのシステム全体で音が出力されていないとき
> ```yaml
> audio:
>  - hz: false
>  - power: false
> ```

### 入力
- キーボード
> ブラウザのキーボード入力の変化を十進数キーコードでYAML形式でリアルタイムでデバイスに送信
>
> 例:
>
> 入力がないとき
> ```yaml
> keys:
>  - false
> ```
>
> 'A'キーが押されたとき
> ```yaml
> keys:
>  - 65
> ```
>
> Shiftキーと'2'キーが押されたとき
> ```yaml
> keys:
>  - 16
>  - 56
> ```
>
> Shiftキーと'2'キーが押された状態から、Shiftキーのみが離されたとき
> ```yaml
> keys:
>  - 56
> ```

- マウス
> ブラウザのマウス入力の変化をYAML形式でデバイスにリアルタイムで送信
>
> 例:
>
> ボタンが押されていないとき
> ```yaml
> mouse:
>  - false
> ```
>
> 左のボタンが押されたとき
> ```yaml
> mouse:
>  - button_left
> ```
>
> 中央(ホイール)のボタンが押されたとき
> ```yaml
> mouse:
>  - button_middle
> ```
>
> 左のボタンと右のボタンが押された状態から、左のボタンのみが離されたとき
> ```yaml
> mouse:
>  - button_right
> ```
>
> マウスが左上に動かされたとき
> ```yaml
> mouse:
>  - displacement:
>     x: -50
>     y: 50
> ```
>
> マウスのホイールが下に動かされたとき
> ```yaml
> mouse:
>  - wheel: -20
> ```

- マイク
> デバイス側のリクエストに応じて、ブラウザのマイク入力をYAML形式でリアルタイムでデバイスに送信
>
> 例:
> 
> ブラウザでマイクに589Hzの音が最大出力の38%で入力されているとき
> ```yaml
> audio:
>  - hz: 589
>  - power: 0.38
> ```
>
> ブラウザでマイクに100Hzの音が最大出力の100%で入力されているとき
> ```yaml
> audio:
>  - hz: 100
>  - power: 100
> ```
>
> ブラウザでマイクがミュートまたは、マイクにアクセスできないとき
> ```yaml
> audio:
>  - hz: null
>  - power: null
> ```

- カメラ
> デバイス側のリクエストに応じて、ブラウザのカメラ映像をハードウェアエンコードを利用し、HEVC形式にエンコードして、UDPでリアルタイムでデバイスに送信

### ポート
- USB
> デバイスとブラウザのUSBポートの信号をYAML形式でリアルタイムで双方向通信
>
> 例:
> 
> ブラウザ側の複数のUSBポートに入力があったとき
> ```yaml
> usb_in:
>  - port1: binary_data_hex
>  - port3: binary_data_hex
> ```
>
> デバイス側から複数のUSBポートに出力したとき
> ```yaml
> usb_out:
>  - port1: binary_data_hex
>  - port2: binary_data_hex
> ```